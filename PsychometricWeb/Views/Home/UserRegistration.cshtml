@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Page</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <div class="card">
        <div class="card-header text-center">
            <h2>User Registration </h2>
        </div>
        <div class="container">
            <div class="row col-md-12" style="margin-top:10px;">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="fullName">Full Name<span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="fullName" placeholder="Enter full name" autocomplete="off" oninput="avoidFirstSpace(event)" required>
                        <div id="fullName" class="invalid-feedback">
                            Please Enter Your Name.
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="userName">User Name<span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="userName" placeholder="Enter username" required autocomplete="off" oninput="avoidFirstSpace(event)">
                        <div id="userName" class="invalid-feedback">
                            Please Enter User Name.
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="password">Password<span class="text-danger">*</span></label>
                        <a id="passwordInfo" data-toggle="tooltip" data-placement="right" title="Password must be at least 6 characters long, include an uppercase letter, a lowercase letter, a number, and a special character.">
                            <i class="fa fa-info-circle"></i>
                        </a>
                        <div class="input-group">
                            <input type="password" maxlength="6" min="6" class="form-control" id="password" placeholder="Enter password" required oninput="avoidFirstSpace(event)">
                            @* <div class="input-group-append">
                            <span class="input-group-text">
                            <i class="fa fa-eye" id="togglePassword" style="cursor: pointer;"></i>
                            </span>
                            </div>  *@
                        </div>
                        <div id="passwordEmpty" class="invalid-feedback">
                            Please enter a password.
                        </div>
                        <div id="passwordInvalid" class="invalid-feedback">
                            Please Enter Valid Password like - Ab#123.
                        </div>
                    </div>

                </div>

            </div>

            <div class="row col-md-12">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="cpassword">Confirm Password<span class="text-danger">*</span></label>
                        <input type="password" maxlength="6" class="form-control" id="cpassword" placeholder="Enter confirm password" required oninput="avoidFirstSpace(event)">
                        <div id="cpassword" class="invalid-feedback">
                            Confirm Password must be Equal to Password.
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="mobile">Mobile Number<span class="text-danger">*</span></label>
                        <input type="text" maxlength="10" id="mobile" name="mobile" class="form-control" placeholder="Enter mobile number" required oninput="avoidFirstSpace(event)">

                        <div id="mobileno" class="invalid-feedback">
                            Please Enter Valid Mobile Number.
                        </div>
                    </div>
                </div>
                <div class="col-md-1" id="getotp" style="display:none;">
                    <div class="form-group">
                        <label></label>
                        <input type="submit" class="btn btn-primary mt-2" id="btnGetOtp" value="Get OTP">
                    </div>
                </div>
                <div class="col-md-3" id="otp" style="display:none;">
                    <div class="form-group">
                        <label for="otp">OTP<span class="text-danger">*</span></label>
                        <input type="text" maxlength="4" id="otp" class="form-control" required oninput="avoidFirstSpace(event)">
                        <div id="otp" class="invalid-feedback">
                            Please Enter Valid otp.
                        </div>
                    </div>
                </div>
                <div class="col-md-1" id="verify" style="display:none;">

                    <div class="form-group">
                        <label></label>

                        <input type="submit" class="btn btn-primary mt-2" id="btnVerify" value="Verify OTP">
                    </div>
                </div>
               
            </div>

            <div class="row col-md-12">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="email">Email<span class="text-danger">*</span></label>
                        <input type="text" id="email" name="email" class="form-control" placeholder="Enter email" oninput="avoidFirstSpace(event)" required>

                        <div id="emailid" class="invalid-feedback">
                            Please Enter Valid e-Mail Address.
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="adharNumber">Aadhaar No.<span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="adharNumber" maxlength="12" placeholder="Enter aadhaar number" required oninput="avoidFirstSpace(event)">
                        <div id="invalidAadhaar" class="invalid-feedback">
                            Please enter aadhaar Number.
                        </div>
                        <div id="invalidAadhaarLength" class="invalid-feedback">
                            Aadhaar number must be exactly 12 digits.
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="adharUpload">Upload Aadhaar<span class="text-danger">*</span></label>
                        <input type="file" class="form-control" id="adharUpload" accept="image/*" required>
                        <div id="adharUploadFeedback" class="invalid-feedback">
                            Please Upload Your Aadhaar Image.
                        </div>
                        <div id="invalidAadhaarImg" class="invalid-feedback">
                            Invalid file type. Please upload an image.
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                </div>
            </div>
        </div>
        <div class="">
            <div class="row">
                <div class=" col-md-2 offset-md-4 ">
                    <input type="submit" class="btn btn-success btn-block" id="btnSubmit" value="Submit">
                </div>
                <div class=" col-md-2">
                    <input type="reset" class="btn btn-danger btn-block" id="resetBtn" value="Cancel">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        var OTPSubmit = 0;

        $(document).ready(function () {

            $('input[type="file"]').change(function () {
                // Your changeAction logic here
                var a = this;
                $("input[name='submit']").attr('disabled', false);
                var filesize = a.files[0].size;
                var val = $(a).val().toLowerCase();
                //var regex = new RegExp("(.*?)\.(pdf)$");
                var regex = RegExp("(.*?)\.(jpg|jpeg|png)$");
                var label = $(a).siblings('.custom-file-label');
                var files = $(a)[0].files;
                var filetype = $(a)[0].files[0];

                if (files.length > 0) {
                    label.html(filetype.name);
                } else if (files.length == 0) {
                    label.html("Choose Files");
                }

                if (!(regex.test(val))) {
                    //swal("", capitalizeString("This file type is not allowed, You can use only .pdf .jpeg .jpg types of file(s). "), "warning");

                    $('#invalidAadhaarImg').show();
                    $('#' + a.id).val("");
                    $(a).val("");
                    label.html("Choose Files");
                    return false;
                } else if (filesize > 2048000) {
                    //swal("", "File size must be 2 MB !", "warning");
                    alert("File size must be 2 MB !");
                    $(a).val("");
                    $('#' + a.id).val("");
                    label.html('Choose Files');
                    return false;
                }
                return false;
            });






        });
        $('#mobile').focus(function () {
            $('#getotp').show();
            $('#tickMarkContainer').hide();

        });
        $('#btnSubmit').click(function () {
            var isValid = true;
            // if (!$('#tickMarkContainer').show()) {
            //     alert('please verify the mobile number first.');
            //     return false;
            // }
            if (!$('#tickMarkContainer').show()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Verification Needed',
                    text: 'Please verify the mobile number first.',
                    confirmButtonText: 'OK',
                });
                return false;
            }
            // Clear previous error messages
            $('.invalid-feedback').hide();

            // Validate Full Name
            var fullName = $('#fullName').val().trim();
            if (fullName === '') {
                $('#fullName').next('.invalid-feedback').show();
                isValid = false;
            }

            // Validate User Name
            var userName = $('#userName').val().trim();
            if (userName === '') {
                $('#userName').next('.invalid-feedback').show();
                isValid = false;
            }

            // Validate Password
            var password = $('#password').val().trim();
            var passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@@$!%*?&])[A-Za-z\d@@$!%*?&]{6,}$/;

            if (password === '') {
                $('#passwordEmpty').show();
                $('#passwordInvalid').hide();
                isValid = false;
            } else if (!passwordPattern.test(password)) {
                $('#passwordEmpty').hide();
                $('#passwordInvalid').show();
                isValid = false;
            } else {
                $('#passwordEmpty').hide();
                $('#passwordInvalid').hide();
            }

            //validate conform password
            var cpassword = $('#cpassword').val().trim();
            if (cpassword !== password) {
                $('#cpassword').val('');
                $('#cpassword').focus();
                $('#cpassword').next('.invalid-feedback').show();
                isValid = false;
            }

            // Validate Email
            var email = $('#email').val().trim();
            var emailPattern = /^[a-zA-Z0-9_.+-]+@@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
            if (email === '' || !emailPattern.test(email)) {
                $('#email').val('');
                $('#email').focus();
                $('#email').next('.invalid-feedback').show();
                isValid = false;
            }

            // Validate Mobile Number
            var mobile = $('#mobile').val().trim();
            var mobilePattern = /^[6-9][0-9]{9}$/;
            if (mobile === '' || !mobilePattern.test(mobile)) {
                $('#mobile').val('');
                $('#mobile').focus();
                $('#mobile').next('.invalid-feedback').show();
                isValid = false;
            }

            // Validate Aadhaar Number
            var adharNumber = $('#adharNumber').val().trim();
            var adharPattern = /^\d{12}$/;

            if (adharNumber === '') {
                $('#adharNumber').val('');
                $('#adharNumber').focus();
                $('#invalidAadhaar').show();
                $('#invalidAadhaarLength').hide();
                isValid = false;
            } else if (!adharPattern.test(adharNumber)) {
                $('#adharNumber').val('');
                $('#adharNumber').focus();
                $('#invalidAadhaar').hide();
                $('#invalidAadhaarLength').show();
                isValid = false;
            } else {
                $('#invalidAadhaar').hide();
                $('#invalidAadhaarLength').hide();
            }

            // Validate Aadhar Upload
            var adharUpload = $('#adharUpload')[0].files[0];
            var validImageTypes = ['image/gif', 'image/jpeg', 'image/png', 'image/svg+xml', 'image/webp'];

            if (!adharUpload) {
                $('#adharUpload').val('');
                $('#adharUpload').focus();
                $('#adharUploadFeedback').show();
                $('#invalidAadhaarImg').hide();
                isValid = false;
            } else if (!validImageTypes.includes(adharUpload.type)) {
                $('#adharUpload').val('');
                $('#adharUpload').focus();
                $('#adharUploadFeedback').hide(); 
                $('#invalidAadhaarImg').show(); 
                isValid = false;
            } else {
                $('#adharUploadFeedback').hide();
                $('#invalidAadhaarImg').hide();
            }

            // If all fields are valid, proceed with the AJAX request
            if (OTPSubmit != 0) {
                Swal.fire({
                    title: 'Confirm Registration',
                    text: 'Are you sure you want to submit your registration?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, submit it!',
                    cancelButtonText: 'No, cancel!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        var formData = new FormData();
                        formData.append('FULLNAME', fullName);
                        formData.append('UNAME', userName);
                        formData.append('PASSWORD', password);
                        formData.append('EMAIL', email);
                        formData.append('PHONE', mobile);
                        formData.append('ADHARNUMBER', adharNumber);
                        formData.append('ADHARUPLOAD', adharUpload);

                        $.ajax({
                            url: '/Home/UserRegistration',
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (response) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Registration Successful',
                                    text: 'Your registration has been successfully completed.'
                                });
                                //Reset();
                                $('#mobile').removeClass('is-valid');
                            },
                            error: function (xhr, status, error) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Registration Failed',
                                    text: 'Registration failed: ' + xhr.responseText
                                });
                            }
                        });
                    }
                });
            }
            else{
                Swal.fire({
                    icon: 'warning',
                    title: 'OTP Required',
                    text: 'Please enter OTP details then proceed!'
                });
            }
        });

        $('#resetBtn').click(function () {
            Reset();
            location.reload();
        });
        function Reset() {
            // Clear all input fields and error messages
            $('#fullName').val('');
            $('#userName').val('');
            $('#password').val('');
            $('#cpassword').val('');
            $('#email').val('');
            $('#mobile').val('');
            $('#adharNumber').val('');
            $('#adharUpload').val('');
            $('.invalid-feedback').hide();
        }
        $('#btnGetOtp').click(function () {
            var mobile = $('#mobile').val().trim();
            var mobilePattern = /^[6-9][0-9]{9}$/;
            if (mobile && mobilePattern.test(mobile)) {
                // Simulate sending OTP
                Swal.fire({
                    title: 'Success',
                    text: 'OTP sent to ' + mobile,
                    icon: 'success',
                    confirmButtonText: 'OK'
                });

                // Hide "Get OTP" button and show OTP input and Verify button
                $('#getotp').hide();
                $('#otp').show();
                $('#verify').show();
            } else {
                Swal.fire({
                    title: 'Warning',
                    text: 'Please enter a valid mobile number.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                OTPSubmit = 0;
            }

        });

        // Handle the "Verify" button click event
        $('#btnVerify').click(function () {
            var otp = $('#otp input').val().trim();
            if (otp === '1234') { // Assuming 1234 is the correct OTP for demo purposes
                Swal.fire({
                    title: 'Success',
                    text: 'Mobile number verified successfully',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });

                // Show a tick mark inside the mobile textbox
                $('#mobile').addClass('is-valid');
                //$('#mobile').after('<span class="tick-mark">✔️</span>');

                // Hide the OTP input and Verify button
                $('#otp').hide();
                $('#verify').hide();
                OTPSubmit = 1;
            } else if(otp===''){
                Swal.fire({
                    title: 'Warning',
                    text: 'Please enter OTP.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
            } else {
                Swal.fire({
                    title: 'Warning',
                    text: 'Invalid OTP. Please try again.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                OTPSubmit = 0;
            }
            

        });
    </script>

    @* <script>
    // Toggle password visibility
    $('#togglePassword').on('click', function () {
    var passwordField = $('#password');
    var passwordFieldType = passwordField.attr('type');
    if (passwordFieldType === 'password') {
    passwordField.attr('type', 'text');
    $(this).removeClass('fa-eye').addClass('fa-eye-slash');
    } else {
    passwordField.attr('type', 'password');
    $(this).removeClass('fa-eye-slash').addClass('fa-eye');
    }
    });
    </script> *@
    <script>
        document.getElementById("fullName").addEventListener("input", function () {
            var fullNameInput = document.getElementById("fullName");

            if (/[^a-zA-Z ]/.test(fullNameInput.value)) {
                fullNameInput.value = fullNameInput.value.replace(/[^a-zA-Z ]/g, '');
            }
        });

        document.getElementById("userName").addEventListener("input", function () {
            var userNameInput = document.getElementById("userName");

            if (/[^a-zA-Z0-9]/.test(userNameInput.value)) {
                userNameInput.value = userNameInput.value.replace(/[^a-zA-Z0-9]/g, '');
            }
        });

        document.getElementById('adharNumber').addEventListener('input', function () {
            // Remove non-numeric characters from the input value
            this.value = this.value.replace(/\D/g, '');
        });
        document.getElementById('mobile').addEventListener('input', function () {
            // Remove non-numeric characters from the input value
            this.value = this.value.replace(/\D/g, '');
        });
    </script>
    <script>
        function avoidFirstSpace(event) {
            var inputElement = event.target;
            var inputValue = inputElement.value;

            if (inputValue.length > 0 && inputValue.charCodeAt(0) === 32) {
                inputElement.value = inputValue.slice(1);
            }
        }
    </script>
</body>


</html>